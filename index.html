<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Moeda Ptax</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/9382/9382189.png">
    <link rel="stylesheet" href="style.css">
    <script src="./helper.js" defer></script>
    <script src="bc-api.js"></script>
</head>

<body>
    <div class="container">
        <h1>Conversor de Moeda Ptax</h1>

        <p class="description">
            Esta página foi criada com o intuito de ser uma melhoria de experiência de uso (UX) da
            <a href="https://www.bcb.gov.br/conversao" target="_blank" rel="noopener" style="color:#3498db;">
                página oficial do Banco Central
            </a>
        </p>

        <div class="input-container">
            <div class="input-fields">
                <div class="input-group">
                    <label for="valorMonetario">Valor:</label>
                    <input type="number" id="valorMonetario" min="0" step="0.01" value="1.00" style="width:120px;">
                </div>
                <div class="input-group">
                    <label for="moedaCotacao">Moeda:</label>
                    <select id="moedaCotacao">
                        <option value="AUD">Dólar australiano (AUD)</option>
                        <option value="CAD">Dólar canadense (CAD)</option>
                        <option value="CHF">Franco suíço (CHF)</option>
                        <option value="DKK">Coroa dinamarquesa (DKK)</option>
                        <option value="EUR">Euro (EUR)</option>
                        <option value="GBP">Libra Esterlina (GBP)</option>
                        <option value="JPY">Iene (JPY)</option>
                        <option value="NOK">Coroa norueguesa (NOK)</option>
                        <option value="SEK">Coroa sueca (SEK)</option>
                        <option value="USD" selected>Dólar dos Estados Unidos (USD)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="dataCotacao">Data da cotação:</label>
                    <input type="date" id="dataCotacao">
                </div>
                <div class="input-group refresh">
                    <button class="button-refresh btn-green" id="reloadCotacao" class="botao-recarregar">
                        <img class="icon" src="https://htmlacademy.ru/assets/icons/reload-6x-white.png">
                    </button>
                </div>
            </div>
        </div>

        <div class="logs-container">
            <div class="logs-title">
                <h2>Logs de Atividade</h2>
                <button id="clearLogs">Limpar Logs</button>
            </div>

            <ul id="logList">
                <li class="empty-logs">Nenhum registro ainda. Digite algo no campo acima.</li>
            </ul>
        </div>


        <div class="list_contato">
            <a href="https://www.linkedin.com/in/gustavo-albuquerque/">
                <img class="linkedin" src="https://cdn-icons-png.flaticon.com/256/174/174857.png" alt="linkedin">
            </a>
            <a href="https://github.com/GustavoRizzo/conversor-ptax-logger">
                <img class="github" src="img/github_logo.png" alt="github">
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Definir data padrão para hoje
            const hoje = new Date();
            const yyyy = hoje.getFullYear();
            const mm = String(hoje.getMonth() + 1).padStart(2, '0');
            const dd = String(hoje.getDate()).padStart(2, '0');
            const dataInput = document.getElementById('dataCotacao');
            dataInput.value = `${yyyy}-${mm}-${dd}`;
            const moedaInput = document.getElementById('moedaCotacao');
            const logList = document.getElementById('logList');
            const clearLogsBtn = document.getElementById('clearLogs');
            const statusEl = document.getElementById('status');

            // Carregar logs do localStorage se existirem
            loadLogsFromStorage();

            // Evento para limpar os logs
            clearLogsBtn.addEventListener('click', function () {
                if (confirm('Tem certeza que deseja limpar todos os logs?')) {
                    logList.innerHTML = '<li class="empty-logs">Nenhum registro ainda. Selecione moeda e data acima.';
                    localStorage.removeItem('inputLogs');
                }
            });

            // Chama processarCotacaoMoeda ao alterar a data ou moeda
            function chamarCotacao() {
                const val = dataInput.value;
                const moeda = moedaInput.value;
                const valor = parseFloat(document.getElementById('valorMonetario').value) || 1;
                // Converter de yyyy-mm-dd para mm-dd-yyyy
                const [ano, mes, dia] = val.split('-');
                const dataFormatada = `${mes}-${dia}-${ano}`;
                processarCotacaoMoeda(moeda, dataFormatada, valor).then(result => {
                    if (result.success && result.data) {
                        addLogConversao(result.data);
                    } else {
                        addLog(`Falha ao obter cotação de ${moeda} em ${val}: ${result.message}`);
                    }
                });
            }
            dataInput.addEventListener('change', chamarCotacao);
            moedaInput.addEventListener('change', chamarCotacao);
            document.getElementById('reloadCotacao').addEventListener('click', chamarCotacao);
            const valorInput = document.getElementById('valorMonetario');
            valorInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    chamarCotacao();
                }
            });
            valorInput.addEventListener('change', chamarCotacao);
            valorInput.addEventListener('blur', chamarCotacao);

            // Faz a invocação inicial
            chamarCotacao();

        });
    </script>
</body>

</html>